!function(){"use strict";var e=angular.module("uniSurvey",["common.services","ui.router","chart.js","ui.sortable"]);e.config(["$logProvider","$stateProvider","$urlRouterProvider",function(e,s,t){e.debugEnabled(!0),s.state("home",{url:"/",templateUrl:"../src/templates/home.html",controller:"HomeController",controllerAs:"home"}).state("create-survey",{url:"create-survey",templateUrl:"../src/templates/create-survey.html",controller:"CreateSurveyController",controllerAs:"surveys"}).state("create-survey-details",{url:"create-survey/{id: [0-9]}",templateUrl:"../src/templates/create-survey-details.html",controller:"CreateSurveyDetailsController",controllerAs:"surveyDetails"}).state("view-results",{url:"view-results",templateUrl:"../src/templates/results.html",controller:"ResultsController",controllerAs:"results"}).state("view-results-details",{url:"view-results/{id: [0-9]}",templateUrl:"../src/templates/results-details.html",controller:"ResultsDetailsController",controllerAs:"resultsDetails"}).state("complete-survey",{url:"complete-survey",templateUrl:"../src/templates/complete-survey.html",controller:"CompleteSurveyController",controllerAs:"completeSurvey"}).state("complete-survey-details",{url:"complete-survey/{id: [0-9]}",templateUrl:"../src/templates/complete-survey-details.html",controller:"CompleteSurveyDetailsController",controllerAs:"completeSurveyDetails"})}]),e.run(["$rootScope","$log",function(e,s){e.$on("$stateNotFound",function(e,t,r,o){s.error("The requested state was not found: ",t)}),e.$on("$stateChangeError",function(e,t,r,o,n,u){s.error("An error occurred while changing states: ",u),s.debug("event",e),s.debug("toState",t),s.debug("toParams",r),s.debug("fromState",o),s.debug("fromParams",n)})}])}(),function(){"use strict";function e(e,s,t,r){var o=this;o.isUserLoggedIn=function(){return!(!s.getProfile().isLoggedIn||!s.getProfile().isActivated)},o.messageType="info",o.message="",o.userData={userName:"",email:"",password:"",confirmPassword:"",accessLevel:"",isActivated:!1,token:""},o.showEmailConfirmationCode=!1,o.userConfirmation={confirmationEmail:"",confirmationCode:""},o.confirmationMessageType="info",o.confirmationMessage="",o.registerUser=function(){o.userData.email&&o.userData.password&&(o.userData.confirmPassword=o.userData.password,e.registration.registerUser(o.userData,function(e){o.confirmPassword="",o.messageType="success",o.message="Registration Successful! Please confirm your email by entering the code recieved by email within the accordian below. ",o.showEmailConfirmationCode=!0},function(e){o.isLoggedIn=!1,o.messageType="danger",o.message="Register Unsuccessful! Please make sure the email is not already in use. "}))},o.login=function(){o.userData.email&&o.userData.password&&(o.message="",o.userData.grant_type="password",o.userData.userName=o.userData.email,e.login.loginUser(o.userData,function(e){o.message="",o.password="",o.userData.token=e.access_token,localStorage.setItem("token",e.access_token),t.get.getAccessLevel({email:o.userData.email},function(e){null!=e.accessLevel?o.userData.accessLevel=e.accessLevel:o.userData.accessLevel=1,null!=e.isActivated&&(o.userData.isActivated=e.isActivated),null!=e.isActivated&&e.isActivated!==!1||(o.messageType="danger",o.message="Your account is not activated, please check your email and insert the confirmation code below"),r.go("home"),s.setProfile(o.userData.userName,o.userData.token,!0,o.userData.isActivated)})},function(e){o.password="",o.messageType="danger",e.data&&e.data.error_description&&(o.message+=e.data.error_description),e.data&&e.data.exceptionMessage&&(o.message+=e.data.exceptionMessage)}))},o.logout=function(){s.setProfile(null,null,!1,!1),localStorage.removeItem("token"),o.userData.token="",o.userData.isActivated="",r.go("home"),e.logout.logoutUser(null,null,null)},o.confirmRegistration=function(){o.userConfirmation.confirmationEmail&&o.userConfirmation.confirmationCode&&t.confirm.confirmRegistration(o.userConfirmation,function(e){o.confirmationMessageType="success",o.confirmationMessage="Registration Confirmed, you may now Login. "},function(e){o.confirmationMessageType="danger",o.confirmationMessage="Your account could not be confirmed, please check your email and / or confirmation code and try again. "})},o.activeLink=function(e){return r.is(e)||r.is(e+"-details")?"active":""}}angular.module("uniSurvey").controller("MainCtrl",["userAccountResource","currentUser","userRoleResource","$state",e])}(),function(){"use strict";angular.module("common.services",["ngResource"]).constant("appSettings",{serverPath:"http://localhost:51608"})}(),function(){"use strict";function e(){var e={isLoggedIn:!1,username:"",token:"",isActivated:!1},s=function(s,t,r,o){e.username=s,e.token=t,e.isLoggedIn=r,e.isActivated=o},t=function(){return e};return{setProfile:s,getProfile:t}}angular.module("common.services").factory("currentUser",e)}(),function(){"use strict";function e(e,s,t,r,o){var n=this;n.surveySubmitted=!1,n.currentSurvey={id:r.id,title:"",creator:"",isActive:2},n.surveySubmissionDetails={surveyId:r.id,username:"",questions:[]},n.submitSurvey=function(){t.submit.submitSubmission(n.surveySubmissionDetails,function(e){n.surveySubmitted=!0,n.messageType="success",n.message="Survey Submitted"},function(e){if(surveyDetails.messageType="danger",surveyDetails.message=e.statusText+"\r\n",e.data&&e.data.exceptionMessage&&(surveyDetails.message+=e.data.exceptionMessage),e.data.modelState)for(var s in e.data.modelState)surveyDetails.message+=e.data.modelState[s]+"\r\n"})},n.getSurveyQuestions=function(){n.surveySubmissionDetails.questions=s.get.getSurveyQuestions({id:r.id})},n.currentSurvey=e.get.getSurvey({id:n.currentSurvey.id}),n.getSurveyQuestions(),n.surveySubmissionDetails.username=o.getProfile().username}angular.module("uniSurvey").controller("CompleteSurveyDetailsController",["surveyResource","surveyQuestionResource","surveySubmissionResource","$stateParams","currentUser",e])}(),function(){"use strict";function e(e,s){var t=this;t.availableSurveys=[];var r=e.get.getUserSurveys({email:s.getProfile().username});t.availableSurveys=r}angular.module("uniSurvey").controller("CompleteSurveyController",["userSurveyResource","currentUser",e])}(),function(){"use strict";function e(e,s,t,r){var o=this;o.currentSurveyId=e.id,o.studentEmails="",o.surveyDetails={surveyId:o.currentSurveyId,respondents:[""]},o.survey={id:1,title:"",creator:"",isActive:1},o.existingSurveys={surveys:[],selectedSurveyId:0,hasBeenCopied:!1},o.questionId=0,o.surveyQuestions={surveyId:o.currentSurveyId,questions:[]},o.questionTypes=[{name:"textfield",value:"Text Field"},{name:"textarea",value:"Text Area"},{name:"dropdown",value:"Dropdown List"},{name:"radio",value:"Radio Buttons"}],o.newQuestionType=o.questionTypes[0].name,o.addQuestion=function(){o.questionId++;var e={id:o.questionId,surveyId:o.currentSurveyId,sortOrder:o.questionId,title:"Question - "+o.questionId,type:o.newQuestionType,value:"",isRequired:!0,options:[],isNew:!0};o.surveyQuestions.questions.push(e)},o.removeQuestion=function(e){o.questionsMessage="";for(var s=0;s<o.surveyQuestions.questions.length;s++)if(o.surveyQuestions.questions[s].id===e){o.surveyQuestions.questions[s].isNew||r.remove.removeQuestion({surveyId:o.surveyQuestions.questions[s].surveyId,questionId:o.surveyQuestions.questions[s].id}),o.surveyQuestions.questions.splice(s,1);break}},o.addOption=function(e){for(var s=0,t=-1,r=0;r<o.surveyQuestions.questions.length;r++)if(o.surveyQuestions.questions[r].id===e){t=r,s=0===o.surveyQuestions.questions[r].options.length?1:o.surveyQuestions.questions[r].options[o.surveyQuestions.questions[r].options.length-1].id+1;break}var n=s,u={id:n,title:"Option "+n,value:n};t!==-1&&o.surveyQuestions.questions[t].options.push(u)},o.questionTypeHasOptions=function(e){return"radio"===e||"dropdown"===e},o.getExistingQuestions=function(){o.surveyQuestions.questions=r.get.getSurveyQuestions({id:o.currentSurveyId})},o.hasValidTitles=function(){for(var e=0;e<o.surveyQuestions.questions.length;e++){if(!o.surveyQuestions.questions[e].title)return!1;for(var s=0;s<o.surveyQuestions.questions[e].options.length;s++)if(!o.surveyQuestions.questions[e].options[s].title)return!1}return!0},o.updateSortOrder=function(){for(var e=0;e<o.surveyQuestions.questions.length;e++)o.surveyQuestions.questions[e].sortOrder=e+1},o.isSurveyEditable=function(e){return 1===e},o.saveQuestions=function(){return o.questionsMessageType="",o.questionsMessage="",o.copyQuestionsMessage="",o.surveyQuestions.questions.length<=0?(o.questionsMessageType="danger",void(o.questionsMessage="Please add questions before attempting to save")):o.hasValidTitles()?(o.updateSortOrder(),void(o.areOptionsValid()&&r.save.saveSurveyQuestions(o.surveyQuestions.questions,function(e){o.surveyQuestions.questions=e,o.questionsMessageType="success",o.questionsMessage="Questions Added and / or Modified"},function(e){if(o.questionsMessageType="danger",o.questionsMessage=e.statusText+"\r\n",e.data&&e.data.exceptionMessage&&(o.questionsMessage+=e.data.exceptionMessage),e.data.modelState)for(var s in e.data.modelState)o.questionsMessage+=e.data.modelState[s]+"\r\n"}))):(o.questionsMessageType="danger",void(o.questionsMessage="Please add valid question titles and / or options before attempting to save"))},o.areOptionsValid=function(){for(var e=0;e<o.surveyQuestions.questions.length;e++)if(0===o.surveyQuestions.questions[e].options.length){var s=o.questionTypeHasOptions(o.surveyQuestions.questions[e].type);if(s)return o.questionsMessageType="danger",o.questionsMessage="Please add options to Radio Buttons or Dropdown questions before attempting to save",!1}return!0},o.convertEmailsToEmailList=function(e){var s=e.split(",");return s},o.trimEmails=function(e){for(var s=0;s<e.length;s++)e[s]=e[s].trim();return e},o.validateEmail=function(e){var s=/\S+@\S+\.\S+/;return s.test(e)},o.hasNewQuestions=function(){for(var e=0;e<o.surveyQuestions.questions.length;e++)if(o.surveyQuestions.questions[e].isNew)return!0;return!1},o.sendToStudents=function(){if(o.message="",o.copyQuestionsMessage="",o.surveyQuestions.questions.length<=0)return o.messageType="danger",void(o.message="Please make sure a survey has saved questions before attempting to send to students");if(o.hasNewQuestions())return o.messageType="danger",void(o.message="Please save your Survey Questions or remove any new questions which were added since no updates to surveys will be allowed once the survey has been sent");o.surveyDetails.respondents=o.convertEmailsToEmailList(o.studentEmails),o.surveyDetails.respondents=o.trimEmails(o.surveyDetails.respondents);for(var e=0;e<o.surveyDetails.respondents.length;e++){var s=o.validateEmail(o.surveyDetails.respondents[e]);if(!s)return o.messageType="danger",void(o.message="One or more email address is invalid")}t.send.sendToStudents(o.surveyDetails,function(e){o.messageType="success",o.message="Sent to Students",o.survey.isActive=0,o.sortableOptions.disabled=!o.isSurveyEditable(o.survey.isActivee)},function(e){if(o.messageType="danger",o.message=e.statusText+"\r\n",e.data&&e.data.exceptionMessage&&(o.message+=e.data.exceptionMessage),e.data.modelState)for(var s in e.data.modelState)o.message+=e.data.modelState[s]+"\r\n"})},o.copyQuestions=function(){var e=r.get.getSurveyQuestions({id:o.existingSurveys.selectedSurveyId});e.$promise.then(function(e){for(var s=0;s<e.length;s++)e[s].surveyId=o.currentSurveyId,e[s].isNew=!0;o.surveyQuestions.questions.push.apply(o.surveyQuestions.questions,e),o.surveyQuestions.hasBeenCopied=!0,e.length>0&&(o.copyQuestionsMessageType="success",o.copyQuestionsMessage=e.length+" questions have been copied. You may now edit the  questions, remove any questions, add more questions and edit the sort order. Remember to press save when done. ")},function(){o.copyQuestionsMessageType="danger",o.copyQuestionsMessage="No questions were copied, the selected questionnaire may not have any saved questions. "})},o.getSurvey=function(){var e=s.get.getSurvey({id:o.currentSurveyId});e.$promise.then(function(e){o.survey=e,o.sortableOptions.disabled=!o.isSurveyEditable(e.isActive)})},o.getSurveys=function(){var e=s.getSurveys.getSurveys();e.$promise.then(function(e){for(var s=0;s<e.length;s++)e[s].id===+o.currentSurveyId&&e.splice(s,1);o.existingSurveys.surveys=e,o.existingSurveys.selectedSurveyId=o.existingSurveys.surveys[0].id})},o.getSurvey(),o.getExistingQuestions(),o.getSurveys(),o.sortableOptions={disabled:!1}}angular.module("uniSurvey").controller("CreateSurveyDetailsController",["$stateParams","surveyResource","respondentResource","surveyQuestionResource",e])}(),function(){"use strict";function e(e,s){var t=this;t.survey={id:1,title:"",creator:"",isActive:1},t.activeSurveys=[],t.getSurveys=function(){var s=e.getSurveys.getSurveys();return s},t.createSurvey=function(){if(t.survey.title){var r=s.getProfile();t.survey.creator=r.username,e.save.saveSurvey(t.survey,function(e){t.survey.title="",t.messageType="success",t.message="Survey Created",t.activeSurveys=t.getSurveys()},function(e){if(t.messageType="danger",t.message=e.statusText+"\r\n",e.data&&e.data.exceptionMessage&&(t.message+=e.data.exceptionMessage),e.data.modelState)for(var s in e.data.modelState)t.message+=e.data.modelState[s]+"\r\n"})}},t.closeSurvey=function(s){t.survey.id=s,t.survey.isActive=2,e.update.closeFeedback(t.survey,function(e){t.survey.title="",t.messageType="success",t.message="Survey Closed",t.activeSurveys=t.getSurveys()},function(e){if(t.messageType="danger",t.message=e.statusText+"\r\n",e.data&&e.data.exceptionMessage&&(t.message+=e.data.exceptionMessage),e.data.modelState)for(var s in e.data.modelState)t.message+=e.data.modelState[s]+"\r\n"})},t.activeSurveys=t.getSurveys()}angular.module("uniSurvey").controller("CreateSurveyController",["surveyResource","currentUser",e])}(),function(){"use strict";function e(e){var s=this;s.isLoggedIn=function(){return!(!e.getProfile().isLoggedIn||!e.getProfile().isActivated)}}angular.module("uniSurvey").controller("HomeController",["currentUser",e])}(),function(){"use strict";function e(e,s,t){var r=this;r.currentSurveyId=e.id,r.legend=!0,r.isLoading=!0,r.survey={id:1,title:"",creator:"",isActive:1},r.results={questions:[]},r.results.questions=s.get.getQuestionResults({surveyId:r.currentSurveyId},function(e){r.isLoading=!1},function(e){if(r.messageType="danger",r.message=e.statusText+"\r\n",e.data&&e.data.exceptionMessage&&(r.message+=e.data.exceptionMessage),e.data.modelState)for(var s in e.data.modelState)r.message+=e.data.modelState[s]+"\r\n"}),r.getSurvey=function(){r.survey=t.get.getSurvey({id:r.currentSurveyId})},r.getSurvey()}angular.module("uniSurvey").controller("ResultsDetailsController",["$stateParams","resultResource","surveyResource",e])}(),function(){"use strict";function e(e){var s=this;s.closedSurveys=[],s.closedSurveys=e.getClosedSurveys.getSurveys()}angular.module("uniSurvey").controller("ResultsController",["surveyResource",e])}(),function(){"use strict";angular.module("uniSurvey").directive("questionDirective",["$http","$compile",function(e,s){var t=function(e){var s=e.type,t="./src/templates/directives/question/";switch(s){case"textfield":t+="textfield.html";break;case"textarea":t+="textarea.html";break;case"radio":t+="radio.html";break;case"dropdown":t+="dropdown.html"}return t},r=function(r,o){var n=t(r.question);e.get(n).success(function(e){o.html(e),s(o.contents())(r)})};return{template:'<div ng-bind="question"></div>',restrict:"E",scope:{question:"="},link:r}}])}(),function(){"use strict";angular.module("uniSurvey").filter("questionType",function(){return function(e){return"textfield"===e?"Text Field":"textarea"===e?"Text Area":"radio"===e?"Radio Buttons":"dropdown"===e?"Dropdown List":e}})}(),function(){"use strict";angular.module("uniSurvey").filter("surveyStatusCodeToText",function(){return function(e){return 0===e?"Sent to Students":1===e?"Accepting Questions":2===e?"Not Receiving Responses":e}})}(),function(){"use strict";function e(e,s){return{send:e(s.serverPath+"/api/Respondent",null,{sendToStudents:{method:"POST"}})}}angular.module("common.services").factory("respondentResource",["$resource","appSettings",e])}(),function(){"use strict";function e(e,s){return{get:e(s.serverPath+"/api/Result?surveyId=:surveyId",{surveyId:"@surveyId"},{getQuestionResults:{method:"GET",isArray:!0}})}}angular.module("common.services").factory("resultResource",["$resource","appSettings",e])}(),function(){"use strict";function e(e,s){return{get:e(s.serverPath+"/api/SurveyQuestions/:id",{id:"@id"},{getSurveyQuestions:{method:"GET",isArray:!0}}),save:e(s.serverPath+"/api/SurveyQuestions",null,{saveSurveyQuestions:{method:"POST",isArray:!0}}),remove:e(s.serverPath+"/api/SurveyQuestions/:id",{surveyId:"@surveyId",questionId:"@questionId"},{removeQuestion:{method:"PUT"}})}}angular.module("common.services").factory("surveyQuestionResource",["$resource","appSettings",e])}(),function(){"use strict";function e(e,s){return{submit:e(s.serverPath+"/api/SurveySubmission",null,{submitSubmission:{method:"POST"}})}}angular.module("common.services").factory("surveySubmissionResource",["$resource","appSettings",e])}(),function(){"use strict";function e(e,s){return{get:e(s.serverPath+"/api/Survey/:id",{id:"@id"},{getSurvey:{method:"GET",isArray:!1}}),getSurveys:e(s.serverPath+"/api/Survey",null,{getSurveys:{method:"GET",isArray:!0}}),getClosedSurveys:e(s.serverPath+"/api/ClosedSurvey",null,{getSurveys:{method:"GET",isArray:!0}}),save:e(s.serverPath+"/api/Survey",null,{saveSurvey:{method:"POST"}}),update:e(s.serverPath+"/api/Survey",null,{closeFeedback:{method:"PUT"}})}}angular.module("common.services").factory("surveyResource",["$resource","appSettings",e])}(),function(){"use strict";function e(e,s){return{registration:e(s.serverPath+"/api/Account/Register",null,{registerUser:{method:"POST"}}),login:e(s.serverPath+"/Token",null,{loginUser:{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e,s){var t=[];for(var r in e)t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")}}}),logout:e(s.serverPath+"/api/Account/Logout",null,{logoutUser:{method:"POST",headers:{Authorization:"Bearer "+localStorage.getItem("token")}}})}}angular.module("common.services").factory("userAccountResource",["$resource","appSettings","currentUser",e])}(),function(){"use strict";function e(e,s){return{get:e(s.serverPath+"/api/UserRole?email=:email",{email:"@email"},{getAccessLevel:{method:"GET",isArray:!1}}),confirm:e(s.serverPath+"/api/UserRole",null,{confirmRegistration:{method:"PUT"}})}}angular.module("common.services").factory("userRoleResource",["$resource","appSettings",e])}(),function(){"use strict";function e(e,s){return{get:e(s.serverPath+"/api/UserSurvey?email=:email",{email:"@email"},{getUserSurveys:{method:"GET",isArray:!0}})}}angular.module("common.services").factory("userSurveyResource",["$resource","appSettings",e])}();